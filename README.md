# Database Monitoring System (MySQL + Prometheus + Grafana)

A secured monitoring system for MySQL built with Docker. The system collects metrics using Prometheus, stores them in the TSDB, and visualizes them in Grafana. Access to monitoring is allowed only for authenticated users via a custom authorization service.

## Components

| Component | Function |
|-----------|----------|
| MySQL | Main database |
| Python Load Generator | Updates DB data (INSERT/SELECT/UPDATE) |
| Prometheus | Metrics collection + alert rules |
| Prometheus TSDB | Time-series metrics storage |
| Grafana | Visualization |
| Auth Service (Flask + SQLite + JWT) | Authentication + roles + invite registration |
| Nginx | Reverse proxy with proxy-auth |
| mysqld-exporter | MySQL metrics |
| node-exporter | Host metrics |
| Docker Compose | Deployment |

## Features

- MySQL deployed in Docker.
- Real DB activity generated by a Python load generator.
- Prometheus collects metrics from exporters and auth service (if enabled).
- Metrics stored in Prometheus TSDB.
- Grafana visualizes QPS, threads, connections, buffer pool hit rate, slow queries, CPU usage.
- Access restricted to authenticated users only.
- User roles:
  - `viewer` — read-only access
  - `operator` — can generate invite codes
- Registration only by invite code.
- Nginx performs authorization using `/auth/verify` endpoint.

## Run Instructions

### 1. Create environment file

```bash
cp .env.example .env
```

### 2. Start the system

```bash
docker compose up -d
```

### 3. Check container health

```bash
docker compose ps
```

### 4. Open in browser

http://localhost/login

### 5. Login using admin credentials from `.env`

### 6. Access

- Portal after login: `/portal`
- Grafana and Prometheus are accessed only through the portal.

### Stop the system

```bash
docker compose down
```

### Full clean with data removal

```bash
docker volume rm db-monitoring_mysql_data db-monitoring_prometheus_data db-monitoring_grafana_data
```
